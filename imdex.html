<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess.guy</title>
    <script src="graphics.js"></script>
    <script src="functions.js"></script>
</head>
<body>
    <div>
      <canvas id="myCanvas" width="800px" height="800px" style="background-color: black;"></canvas>
    </div>

  <script>

    //site elements
    const canvas = document.getElementById("myCanvas");
    const context = canvas.getContext('2d');

    // game elements
    let x = 0;
    let y = 0;
    let length = 70; // cursor length
    let unit = canvas.height / 8;
    let flag = false;
    class Piece {
      constructor(x, y){
        this.x = x; // piece x coordinate
        this.y = y; // piece y coordinate
        //this.position = [Math.round((this.y / unit) ), Math.round((this.x / unit))]
      }
    }

    //game objects
    let p1Arr = [];
    let p2Arr = [];
    
    for (let i = 0; i < 8; i++){
      p1Arr.push(new Piece(15 + (i * unit), 715));
      p2Arr.push(new Piece(15 + (i * unit), 15));
    }
    let piece;
    let board = [
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0],
      [0, 0, 0, 0, 0, 0, 0, 0]
    ];

    for (let i = 0; i < 8; i++){
      board[7][i] = p1Arr[i];
      board[0][i] = p2Arr[i];
    }

    setInterval(function(){
      draw();
      if(flag){
        piece.x = x - (length / 2);
        piece.y = y - (length / 2);
      }
    }, 1000/60)
    canvas.addEventListener("mousemove", onMouseMove);
    canvas.addEventListener("mousedown", onMouseDown);
    canvas.addEventListener("mouseup", onMouseUp)

    function draw(){
      drawBoard();
      for (let i = 0; i < 8; i++){
        drawRectangle(context, p1Arr[i].x, p1Arr[i].y, length, length, "white", 0, "black");
        drawRectangle(context, p2Arr[i].x, p2Arr[i].y, length, length, "black", 0, "black");
      }
    }

    function onMouseDown(event){ // when mouse is down, and the mouse is over the piece it removes the piece from the board
      let cell = board[Math.floor(y / unit)][Math.floor(x / unit)]; // contents of the cell
      if(cell == 0) return; // checks if user clickd on a a piece
      piece = cell; // impports cell contents to cuurent piece variable
      if(x > piece.x && x < piece.x + length  && y > piece.y && y < piece.y + length){
        flag = true;
        board[Math.floor(piece.y / unit)][Math.floor(piece.x / unit)] = 0;
      }
    }

    function onMouseUp(event){// when mouse is up the piece stops following it and picks piece final location
      if(flag){
        flag = false;
        board[Math.floor(y / unit)][Math.floor(x / unit)] = piece;
      }
    }

    

  </script>
</body>
</html>